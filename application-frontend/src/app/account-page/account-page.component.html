<main>
    <h2 *ngIf="this.isLoggedIn && this.currentUser.firstName && this.currentUser.lastName">
        Welcome, {{this.currentUser!.firstName! + ' ' + this.currentUser!.lastName!}}!
    </h2>
    <!-- <h2>{{this.plaintextpw}}</h2> -->
    <section *ngIf="this.isLoggedIn" class="account-section">

        <section *ngIf="this.currentUser!.plans!.length === 0">
            <h2>You have no plans on your account.</h2>
            <button type="button" routerLink="/plans">Shop Plans</button>
        </section>
        
        <ng-container class="plans" *ngIf="!(this.currentUser!.plans!.length === 0)">
            <section class="plan" *ngFor="let plan of this.currentUser!.plans; let planIndex = index">
                <h2>{{plan.planType}} Plan</h2>
                <table class="plan-devices-table">
                    <thead >
                        <th>Device</th>
                        <th>Device Price</th>
                        <th>Line</th>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let line of plan.lines; let lineIndex = index; let e = even">
                            <tr *ngIf="line.device" [ngClass]="{
                                'even': e,
                                'odd': !e
                            }">
                            <td *ngIf="line.device">{{line.device.brand}} {{line.device.model}}</td><td *ngIf="!line.device">no device</td>
                            <td *ngIf="line.device">{{line.device.price}}</td><td *ngIf="!line.device">no device</td>
                            <td>{{line.number}}</td>
                            <td><button (click)="this.removeLine(planIndex, lineIndex)">Remove Line</button></td>
                            <td *ngIf="line.device !== null"><button>Change Device</button></td>
                            <button *ngIf="line.device === null" type="button" routerLink="/devices">Shop Devices</button>
                            </tr>

                        </ng-container>
                    </tbody>
                </table>
                <h3>Plan Price: {{plan.price | currency}}</h3>
                <div class="planbuttonsarea">
                    <button type="button" (click)="this.removePlan(plan)">Remove Plan</button>
                    <button type="button" (click)="this.addLine(plan)">Add a line</button>
                </div>
            </section>
        </ng-container>

        <div *ngIf="this.isLoggedIn">
            <h2>Monthly Bill</h2>
            <table>
                <thead>
                    <th>Category</th>
                    <th>Total</th>
                </thead>

                <tbody>
                    <tr>
                        <td>Devices Total:</td>
                        <td>{{this.devicesTotal | currency}}</td>
                    </tr>
                    <tr>
                        <td>Plans Total:</td>
                        <td>{{this.plansTotal | currency}}</td>
                    </tr>
                    <tr>
                        <td>Monthly Amount Due:</td>
                        <td>{{this.billTotal | currency}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
    
    <section id="loginroute" *ngIf="!this.isLoggedIn">
        <p>Please click the button to log into your account or create a new one.</p>
        <button type="button" routerLink="/login">LOGIN/REGISTER</button>
    </section>

</main>
